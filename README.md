# お問い合わせフォーム(Laravel)

## 開発環境

-   macOS 10.13.6(ホスト OS)
-   ~~VirtualBox 6.1.18~~
-   ~~CentOS 7.9.2009(ゲスト OS)~~
-   Apache 2.4.6
-   MySQL 8.0.23
-   PHP 7.4.15
-   Laravel 7.30.4

## 実装に費やした時間

-   フロントエンド 1 時間
    -   HTML5
    -   CSS3(Sass)
    -   Bootstrap4
    -   Javascript
-   バックエンド 3 時間
    -   PHP
    -   Laravel
-   環境構築 1 時間
    -   CentOS
    -   MySQL
    -   Apache
    -   Gmail

## 実装中に問題となったところ・工夫したところ

-   メール送信には Mailable クラスを使用し、本文は view のテンプレートに値を当てはめて送信できるよう実装した。
-   データベース登録には、Eloquent モデルを利用して行った。
-   バリデーションは、FormRequest クラスを継承した ContactForm クラスで行い、メールアドレスと電話番号については、独自のバリデーションを実装し行った。

## 改善点

-   データベース登録やメール送信が失敗した際にエラーページに遷移してしまうが、再入力できるようにフォームページに戻るように改善したい。
-   各ページのお問い合わせ内容を表示するレイアウトを共通化して、管理を一元化するようにしたい。

## 動作確認

-   ソースコードをルート直下に配置する。
-   .env.sample のファイル名を .env に変更。
-   データベースとメールの情報を、.env に正しく入力する。
-   composer のインストール
-   テーブルは、マイグレーションを実行して作成する。
-   Google の SMTP 経由でメールを送信し、メールが正しく送信されている。
-   送信完了後、入力値がデータベースに登録されている。
-   管理者とユーザーへ正常にメール送信されている。

### route:list

+--------+----------+----------+------+-----------------------------------------------+------------+

| | POST | / | | App\Http\Controllers\HomeController@back | web |<br>
| | GET|HEAD | / | | App\Http\Controllers\HomeController@index | web |<br>
| | GET|HEAD | api/user | | Closure | api |<br>
| | | | | | auth:api |<br>
| | POST | comfirm | | App\Http\Controllers\ComfirmController@index | web |<br>
| | POST | register | | App\Http\Controllers\RegisterController@index | web |<br>

+--------+----------+----------+------+-----------------------------------------------+------------+

### 検証ブラウザ

-   Firefox 78.7.0esr
-   Google Chrome 88.0.4324.150

### フォームページ

-   すべて正常値の場合のみ確認ページに遷移する。

#### 入力チェック

-   件名(必須 セレクトボックス:ご意見 | ご感想 | その他)

    -   未選択の場合エラーメッセージ表示。
    -   正しい選択肢のみ表示。
    -   選択肢以外を選ぶとエラーメッセージ表示。
    -   プルダウン値から選択すると正常に遷移。

-   名前(50 文字以内 必須)

    -   未入力の場合はエラーメッセージ表示。
    -   50 文字以上は入力できない。(maxlength="50")
    -   半角英数字 50 文字以内の入力で正常に遷移。
    -   半角英数字 50 文字以上入力した場合はエラーメッセージ表示。
    -   閾値の入力(48-50 文字:OK, 51-52 文字:NG)

-   メールアドレス(必須 半角英数字と@のみ 255 文字以内)

    -   RFC822 に沿った形式(ユーザー名@ドメイン)かつ半角英数字 255 文字で正常に遷移。
    -   全角入力でエラーメッセージ表示。
    -   RFC822 に沿わない形式の場合はエラーメッセージ表示。
    -   未入力の場合エラーメッセージ表示。
    -   255 文字以上は入力できない。(maxlength="255")

-   電話番号(必須 半角数字 8-12 桁以内)

    -   未入力でエラーメッセージ表示。
    -   半角数字 8-12 桁で正常に遷移。
    -   半角/全角文字でエラーメッセージ表示。
    -   閾値の入力(11-12 桁:OK, 13-14 桁:NG)

-   お問い合わせ内容(必須 255 文字以内)

    -   未入力の場合はエラーメッセージ表示。
    -   255 文字以上は入力できない。(maxlength="255")
    -   半角英数字 255 文字以内の入力で正常に遷移。
    -   半角英数字 255 文字以上入力した場合はエラーメッセージ表示。
    -   閾値の入力(254-255 文字:OK, 256-257 文字:NG)

#### 確認ページ

-   入力値が正常に表示されている。
-   修正ボタンを押すと、入力値を保持したままフォームページ戻る。
-   送信ボタンを押すと、送信完了ページに遷移。
-   お問い合わせ内容の入力に改行がある場合、改行されて表示されている。

#### 送信完了ページ

-   送信した内容が表示されている。
-   お問い合わせ内容の入力に改行がある場合、改行されて表示されている。

## 参考資料

-   [Laravel 7.x TOC](https://readouble.com/laravel/7.x/ja/)
-   [Laravel メール送信機能の実装で mailtrap や Gmail の SMTP サーバーを使ってみる](https://qiita.com/KZ-taran/items/ffa60ac6353bc4dcc759)
-   [aravel5.6, 5.7 独自のバリデーションルールを追加しよう！](https://tac-blog.tech/index.php/2018/09/08/add-validation-rule/)
